<!DOCTYPE html>

<html lang="en" data-content_root="../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>plotting &#8212; funcsim 0.1.0 documentation</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=5ecbeea2" />
    <link rel="stylesheet" type="text/css" href="../_static/basic.css?v=b08954a9" />
    <link rel="stylesheet" type="text/css" href="../_static/alabaster.css?v=27fed22d" />
    <script src="../_static/documentation_options.js?v=01f34227"></script>
    <script src="../_static/doctools.js?v=9bcbadda"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  

  
  

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <h1>Source code for plotting</h1><div class="highlight"><pre>
<span></span>
<span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">xarray</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">xr</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">warnings</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Callable</span><span class="p">,</span> <span class="n">Optional</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">conversions</span>


<div class="viewcode-block" id="fan">
<a class="viewcode-back" href="../api_plotting.html#funcsim.fan">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">fan</span><span class="p">(</span><span class="n">da</span><span class="p">:</span> <span class="n">xr</span><span class="o">.</span><span class="n">DataArray</span><span class="p">,</span>
        <span class="n">varname</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">filepath</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">line_color</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;blue&#39;</span><span class="p">,</span>
        <span class="n">title</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
        <span class="n">width</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">750</span><span class="p">,</span>
        <span class="n">height</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">400</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Create a fan chart for a variable from a simulation output xr.DataArray.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    da : xr.DataArray</span>
<span class="sd">        Simulation results with dimensions &quot;trials&quot;, &quot;variables&quot;, &quot;steps&quot;.</span>
<span class="sd">    varname : str</span>
<span class="sd">        Name of the variable to plot from the &quot;variables&quot; dimension.</span>
<span class="sd">    filepath : str, opti</span>
<span class="sd">        Path to save the chart. Supports HTML and image formats. Default None.</span>
<span class="sd">    line_color : str, optional</span>
<span class="sd">        Color of the mean line. Default is &#39;blue&#39;.</span>
<span class="sd">    title : str, optional</span>
<span class="sd">        Title for the figure. Default is &quot;&quot; (no title).</span>
<span class="sd">    width : int, optional</span>
<span class="sd">        Width of the chart in pixels. Default is 800.</span>
<span class="sd">    height : int, optional</span>
<span class="sd">        Height of the chart in pixels. Default is 500.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    plotly.graph_objects.Figure</span>
<span class="sd">        The Plotly figure object for the fan chart.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># conditional import of plotly</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="kn">import</span><span class="w"> </span><span class="nn">plotly.graph_objects</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">go</span>
    <span class="k">except</span> <span class="n">importerror</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">importerror</span><span class="p">(</span><span class="s2">&quot;optional dependency &#39;plotly&#39; is required for all &quot;</span>
                            <span class="s2">&quot;funcsim plotting fucntions. install with &quot;</span>
                            <span class="s2">&quot;`pip install plotly`.&quot;</span><span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">e</span>
  
    <span class="c1"># Validate input DataArray dimensions</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">all</span><span class="p">(</span><span class="n">dim</span> <span class="ow">in</span> <span class="n">da</span><span class="o">.</span><span class="n">dims</span> <span class="k">for</span> <span class="n">dim</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;trials&quot;</span><span class="p">,</span> <span class="s2">&quot;variables&quot;</span><span class="p">,</span> <span class="s2">&quot;steps&quot;</span><span class="p">]):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Input DataArray &#39;da&#39; must have dimensions &#39;trials&#39;,&quot;</span>
                         <span class="s2">&quot;&#39;variables&#39;, and &#39;steps&#39;.&quot;</span><span class="p">)</span>
    
    <span class="c1"># Validate if varname exists in the DataArray</span>
    <span class="k">if</span> <span class="n">varname</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">da</span><span class="p">[</span><span class="s2">&quot;variables&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Variable &#39;</span><span class="si">{</span><span class="n">varname</span><span class="si">}</span><span class="s2">&#39; not found in DataArray&#39;s &quot;</span>
                         <span class="sa">f</span><span class="s2">&quot;&#39;variables&#39; coordinate.&quot;</span><span class="p">)</span>

    <span class="c1"># Select the specified variable and convert to a pandas DataFrame</span>
    <span class="c1"># Transpose so that &#39;steps&#39; becomes the index and &#39;trials&#39; become columns</span>
    <span class="n">dt</span> <span class="o">=</span> <span class="n">da</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">variables</span><span class="o">=</span><span class="n">varname</span><span class="p">)</span><span class="o">.</span><span class="n">to_pandas</span><span class="p">()</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span>
    
    <span class="k">if</span> <span class="n">dt</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Warning: Data for variable &#39;</span><span class="si">{</span><span class="n">varname</span><span class="si">}</span><span class="s2">&#39; is empty after &quot;</span>
                      <span class="sa">f</span><span class="s2">&quot;selection and processing.&quot;</span><span class="p">,</span> <span class="ne">UserWarning</span><span class="p">)</span>
        <span class="c1"># Return an empty figure or handle as appropriate</span>
        <span class="n">fig</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Figure</span><span class="p">()</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span><span class="n">title_text</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">varname</span><span class="si">}</span><span class="s2"> (No data)&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">fig</span>

    <span class="c1"># &#39;steps&#39; values from the index of the transposed DataFrame</span>
    <span class="n">idx_original</span> <span class="o">=</span> <span class="n">dt</span><span class="o">.</span><span class="n">index</span> <span class="c1"># Keep original for potential messages or fallback</span>
    <span class="n">idx</span> <span class="o">=</span> <span class="n">dt</span><span class="o">.</span><span class="n">index</span> 
    
    <span class="c1"># Ensure index is JSON serializable by converting to Timestamps if it</span>
    <span class="c1"># contains Periods. This handles both PeriodIndex and object-dtype Index</span>
    <span class="c1"># containing Period objects.</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">idx</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">PeriodIndex</span><span class="p">):</span>
        <span class="n">idx</span> <span class="o">=</span> <span class="n">idx</span><span class="o">.</span><span class="n">to_timestamp</span><span class="p">()</span>
        <span class="c1"># print(&quot;DEBUG: Converted PeriodIndex to DatetimeIndex.&quot;) # Optional</span>
    <span class="k">elif</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">idx</span><span class="p">,</span> <span class="s1">&#39;dtype&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">pd</span><span class="o">.</span><span class="n">api</span><span class="o">.</span><span class="n">types</span><span class="o">.</span><span class="n">is_object_dtype</span><span class="p">(</span><span class="n">idx</span><span class="o">.</span><span class="n">dtype</span><span class="p">):</span>
        <span class="c1"># If it&#39;s an object-dtype idx, check if it might contain Period objects.</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">converted_values</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="n">needs_conversion</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">idx</span><span class="p">:</span>
                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">Period</span><span class="p">):</span>
                        <span class="n">converted_values</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">to_timestamp</span><span class="p">())</span>
                        <span class="n">needs_conversion</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="c1"># Pass through other types (e.g., pd.NaT, None, or</span>
                        <span class="c1"># other data if mixed)</span>
                        <span class="n">converted_values</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">)</span> 
                
                <span class="k">if</span> <span class="n">needs_conversion</span><span class="p">:</span>
                    <span class="n">idx</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DatetimeIndex</span><span class="p">(</span><span class="n">converted_values</span><span class="p">)</span>
                    <span class="c1"># print(&quot;DEBUG: Converted object-dtype index with Period &quot;</span>
                    <span class="c1">#       &quot;objects to DatetimeIndex.&quot;) # Optional debug</span>
                <span class="c1"># If no Period objects were found and converted, idx remains the</span>
                <span class="c1"># original object-dtype index.</span>
                    
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="c1"># This might happen if conversion of an item fails unexpectedly.</span>
                <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Warning: Attempted to convert an object-dtype &quot;</span>
                              <span class="sa">f</span><span class="s2">&quot;index that might contain Periods, but an error &quot;</span>
                              <span class="sa">f</span><span class="s2">&quot;occurred: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">. Using original index for x-axis,&quot;</span>
                              <span class="sa">f</span><span class="s2">&quot; which may lead to Plotly errors.&quot;</span><span class="p">,</span> <span class="ne">UserWarning</span><span class="p">)</span>
                <span class="n">idx</span> <span class="o">=</span> <span class="n">idx_original</span> <span class="c1"># Revert to original index</span>
        
    <span class="c1"># Calculate the mean across trials for each step</span>
    <span class="n">mean_values</span> <span class="o">=</span> <span class="n">dt</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

    <span class="c1"># Initialize a Plotly Figure</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Figure</span><span class="p">()</span>

    <span class="c1"># Define the quantile band widths to plot (from widest to narrowest</span>
    <span class="c1"># for layering)</span>
    <span class="n">band_widths</span> <span class="o">=</span> <span class="p">[</span><span class="mi">90</span><span class="p">,</span> <span class="mi">70</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">10</span><span class="p">]</span> 
    
    <span class="c1"># Add quantile bands as filled areas</span>
    <span class="k">for</span> <span class="n">band_width</span> <span class="ow">in</span> <span class="n">band_widths</span><span class="p">:</span>
        <span class="c1"># Calculate upper and lower percentile values</span>
        <span class="n">upper_percentile_val</span> <span class="o">=</span> <span class="mf">100.0</span> <span class="o">-</span> <span class="p">(</span><span class="mf">100.0</span> <span class="o">-</span> <span class="nb">float</span><span class="p">(</span><span class="n">band_width</span><span class="p">))</span> <span class="o">/</span> <span class="mf">2.0</span>
        <span class="n">lower_percentile_val</span> <span class="o">=</span> <span class="p">(</span><span class="mf">100.0</span> <span class="o">-</span> <span class="nb">float</span><span class="p">(</span><span class="n">band_width</span><span class="p">))</span> <span class="o">/</span> <span class="mf">2.0</span>
        
        <span class="c1"># Calculate percentile values across trials for each step</span>
        <span class="n">y_lower</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">dt</span><span class="p">,</span> <span class="n">lower_percentile_val</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">y_upper</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">dt</span><span class="p">,</span> <span class="n">upper_percentile_val</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="c1"># Add a scatter trace for the filled area</span>
        <span class="c1"># X-coordinates go from start to end for the upper bound, then end to</span>
        <span class="c1"># start for the lower bound</span>
        <span class="c1"># Y-coordinates match this path to create a closed shape</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span><span class="n">go</span><span class="o">.</span><span class="n">Scatter</span><span class="p">(</span>
            <span class="n">x</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span> <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="n">idx</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]),</span> 
            <span class="n">y</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">y_upper</span><span class="p">)</span> <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="n">y_lower</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]),</span> 
            <span class="n">fill</span><span class="o">=</span><span class="s1">&#39;toself&#39;</span><span class="p">,</span>  <span class="c1"># Fill the area enclosed by the trace</span>
            <span class="n">fillcolor</span><span class="o">=</span><span class="s1">&#39;rgba(173, 216, 230, 0.4)&#39;</span><span class="p">,</span>  <span class="c1"># Light blue with 20% opacity</span>
            <span class="n">line</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;rgba(255,255,255,0)&#39;</span><span class="p">),</span>  <span class="c1"># No visible band edges</span>
            <span class="n">hoverinfo</span><span class="o">=</span><span class="s2">&quot;skip&quot;</span><span class="p">,</span>  <span class="c1"># Don&#39;t show hover tooltips for the band shapes</span>
            <span class="n">showlegend</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>  <span class="c1"># Don&#39;t show these bands in the legend</span>
            <span class="n">name</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">band_width</span><span class="si">}</span><span class="s1">% Quantile&#39;</span> 
        <span class="p">))</span>

    <span class="c1"># Add the mean line (plotted on top of the bands)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span><span class="n">go</span><span class="o">.</span><span class="n">Scatter</span><span class="p">(</span>
        <span class="n">x</span><span class="o">=</span><span class="n">idx</span><span class="p">,</span>
        <span class="n">y</span><span class="o">=</span><span class="n">mean_values</span><span class="p">,</span>
        <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;lines&#39;</span><span class="p">,</span>
        <span class="n">line</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="n">line_color</span><span class="p">),</span> <span class="c1"># Use the specified line color</span>
        <span class="n">name</span><span class="o">=</span><span class="s1">&#39;Mean&#39;</span>  <span class="c1"># Name for the legend</span>
    <span class="p">))</span>

    <span class="c1"># Customize the layout of the figure</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span>
        <span class="n">xaxis_title</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span>      <span class="c1"># Remove the x-axis label (originally &quot;steps&quot;)</span>
        <span class="n">yaxis_title</span><span class="o">=</span><span class="n">varname</span><span class="p">,</span> <span class="c1"># Set y-axis label to variable name</span>
        <span class="n">showlegend</span><span class="o">=</span><span class="kc">True</span>      <span class="c1"># Display the legend (will show the &#39;Mean&#39; trace)</span>
    <span class="p">)</span>

    <span class="c1"># Save the figure to a file if a filepath is provided</span>
    <span class="k">if</span> <span class="n">filepath</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">filepath</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;.html&quot;</span><span class="p">):</span>
                <span class="n">fig</span><span class="o">.</span><span class="n">write_html</span><span class="p">(</span><span class="n">filepath</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Chart saved to </span><span class="si">{</span><span class="n">filepath</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">filepath</span><span class="o">.</span><span class="n">endswith</span><span class="p">((</span><span class="s2">&quot;.png&quot;</span><span class="p">,</span> <span class="s2">&quot;.jpeg&quot;</span><span class="p">,</span> <span class="s2">&quot;.jpg&quot;</span><span class="p">,</span> <span class="s2">&quot;.webp&quot;</span><span class="p">,</span>
                                    <span class="s2">&quot;.svg&quot;</span><span class="p">,</span> <span class="s2">&quot;.pdf&quot;</span><span class="p">)):</span>
                <span class="c1"># Static image export requires the &#39;kaleido&#39; package</span>
                <span class="c1"># You can install it via: pip install -U kaleido</span>
                <span class="n">fig</span><span class="o">.</span><span class="n">write_image</span><span class="p">(</span><span class="n">filepath</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Chart saved to </span><span class="si">{</span><span class="n">filepath</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># Default to HTML if format is unrecognized</span>
                <span class="n">html_filepath</span> <span class="o">=</span> <span class="n">filepath</span><span class="o">.</span><span class="n">rsplit</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;.html&quot;</span>
                <span class="n">fig</span><span class="o">.</span><span class="n">write_html</span><span class="p">(</span><span class="n">html_filepath</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unsupported file format for &#39;</span><span class="si">{</span><span class="n">filepath</span><span class="si">}</span><span class="s2">&#39;. &quot;</span>
                      <span class="sa">f</span><span class="s2">&quot;Saved as HTML: </span><span class="si">{</span><span class="n">html_filepath</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error saving file to &#39;</span><span class="si">{</span><span class="n">filepath</span><span class="si">}</span><span class="s2">&#39;: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="c1"># Fallback to HTML if image saving fails (e.g. Kaleido missing)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">filepath</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;.html&quot;</span><span class="p">):</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">html_fallback_path</span> <span class="o">=</span> \
                        <span class="n">filepath</span><span class="o">.</span><span class="n">rsplit</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;_fallback.html&quot;</span>
                    <span class="n">fig</span><span class="o">.</span><span class="n">write_html</span><span class="p">(</span><span class="n">html_fallback_path</span><span class="p">)</span>
                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;As a fallback, chart saved to </span><span class="si">{</span><span class="n">html_fallback_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">html_e</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Could not save HTML fallback: </span><span class="si">{</span><span class="n">html_e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># make the background grid subtle</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span>
        <span class="n">title</span><span class="o">=</span><span class="n">varname</span><span class="p">,</span>
        <span class="n">xaxis_title</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span>    
        <span class="n">yaxis_title</span><span class="o">=</span><span class="n">varname</span><span class="p">,</span>
        <span class="n">legend</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">borderwidth</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span>
        <span class="n">template</span><span class="o">=</span><span class="s1">&#39;simple_white&#39;</span><span class="p">,</span>
        <span class="n">plot_bgcolor</span><span class="o">=</span><span class="s1">&#39;white&#39;</span>         <span class="c1"># explicit white background</span>
    <span class="p">)</span>

    <span class="n">fig</span><span class="o">.</span><span class="n">update_xaxes</span><span class="p">(</span>
        <span class="n">showgrid</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">gridcolor</span><span class="o">=</span><span class="s1">&#39;rgba(200,200,200,0.4)&#39;</span><span class="p">,</span>
        <span class="n">gridwidth</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">update_yaxes</span><span class="p">(</span>
        <span class="n">showgrid</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">gridcolor</span><span class="o">=</span><span class="s1">&#39;rgba(200,200,200,0.4)&#39;</span><span class="p">,</span>
        <span class="n">gridwidth</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">)</span>
    <span class="k">if</span> <span class="n">title</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span>
            <span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="c1"># resize for fitting in a jupyter window without scrolling</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="n">height</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">fig</span> <span class="c1"># Return the Plotly figure object</span></div>



<div class="viewcode-block" id="twofuncs">
<a class="viewcode-back" href="../api_plotting.html#funcsim.twofuncs">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">twofuncs</span><span class="p">(</span><span class="n">f0</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="nb">float</span><span class="p">],</span> <span class="nb">float</span><span class="p">],</span>
             <span class="n">f1</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="nb">float</span><span class="p">],</span> <span class="nb">float</span><span class="p">],</span>
             <span class="n">xmin</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
             <span class="n">xmax</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
             <span class="n">name0</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;f0&quot;</span><span class="p">,</span>
             <span class="n">name1</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;f1&quot;</span><span class="p">,</span>
             <span class="n">title</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
             <span class="n">width</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">750</span><span class="p">,</span>
             <span class="n">height</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">400</span>
             <span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Plot two functions on the same axes using Plotly.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    f0 : callable</span>
<span class="sd">        First function to plot. Should accept a float and return a float.</span>
<span class="sd">    f1 : callable</span>
<span class="sd">        Second function to plot. Should accept a float and return a float.</span>
<span class="sd">    xmin : float</span>
<span class="sd">        Minimum value of the x-axis.</span>
<span class="sd">    xmax : float</span>
<span class="sd">        Maximum value of the x-axis.</span>
<span class="sd">    name0 : str, optional</span>
<span class="sd">        Label for the first function. Default is &quot;f0&quot;.</span>
<span class="sd">    name1 : str, optional</span>
<span class="sd">        Label for the second function. Default is &quot;f1&quot;.</span>
<span class="sd">    title : str, optinal</span>
<span class="sd">        Title for the top of the figure.  Defaults to None.</span>
<span class="sd">    width : int, optional</span>
<span class="sd">        Width of the chart in pixels. Default is 800.</span>
<span class="sd">    height : int, optional</span>
<span class="sd">        Height of the chart in pixels. Default is 500.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    plotly.graph_objects.Figure</span>
<span class="sd">        The Plotly figure object with both functions plotted.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># conditional import of plotly</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="kn">import</span><span class="w"> </span><span class="nn">plotly.graph_objects</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">go</span>
    <span class="k">except</span> <span class="ne">ImportError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ImportError</span><span class="p">(</span><span class="s2">&quot;Optional dependency &#39;plotly&#39; is required for all &quot;</span>
                            <span class="s2">&quot;funcsim plotting fucntions. Install with &quot;</span>
                            <span class="s2">&quot;`pip install plotly`.&quot;</span><span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">e</span>
 
    <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">xmin</span><span class="p">,</span> <span class="n">xmax</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
    <span class="n">y0</span> <span class="o">=</span> <span class="p">[</span><span class="n">f0</span><span class="p">(</span><span class="n">val</span><span class="p">)</span> <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">x</span><span class="p">]</span>
    <span class="n">y1</span> <span class="o">=</span> <span class="p">[</span><span class="n">f1</span><span class="p">(</span><span class="n">val</span><span class="p">)</span> <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">x</span><span class="p">]</span>

    <span class="n">fig</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Figure</span><span class="p">()</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span><span class="n">go</span><span class="o">.</span><span class="n">Scatter</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">y0</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;lines&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name0</span><span class="p">))</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span><span class="n">go</span><span class="o">.</span><span class="n">Scatter</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">y1</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;lines&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name1</span><span class="p">))</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span>
        <span class="n">xaxis_title</span><span class="o">=</span><span class="s2">&quot;x&quot;</span><span class="p">,</span>
        <span class="n">yaxis_title</span><span class="o">=</span><span class="s2">&quot;y&quot;</span><span class="p">,</span>
        <span class="n">template</span><span class="o">=</span><span class="s2">&quot;simple_white&quot;</span>
    <span class="p">)</span>
    <span class="k">if</span> <span class="n">title</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span>
            <span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="c1"># resize for fitting in a jupyter window without scrolling</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="n">height</span><span class="p">)</span>
 
    <span class="k">return</span> <span class="n">fig</span></div>



<div class="viewcode-block" id="histpdf">
<a class="viewcode-back" href="../api_plotting.html#funcsim.histpdf">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">histpdf</span><span class="p">(</span><span class="n">data</span><span class="p">:</span> <span class="n">conversions</span><span class="o">.</span><span class="n">VectorLike</span><span class="p">,</span>
            <span class="n">pdf</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="nb">float</span><span class="p">],</span> <span class="nb">float</span><span class="p">],</span>
            <span class="n">nbins</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">title</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
            <span class="n">width</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">750</span><span class="p">,</span>
            <span class="n">height</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">400</span>
            <span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Plot a histogram of data and a probability density function (PDF).</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    data : VectorLike</span>
<span class="sd">        Input data to plot as a histogram.</span>
<span class="sd">    pdf : Callable[[float], float]</span>
<span class="sd">        Probability density function to plot. Should accept a float and</span>
<span class="sd">        return a float.</span>
<span class="sd">    nbins : int, optional</span>
<span class="sd">        Number of bins for the histogram. If None, uses &#39;auto&#39; binning.</span>
<span class="sd">    title : str, optional</span>
<span class="sd">        Title for the figure. Default is &quot;&quot; (no title).</span>
<span class="sd">    width : int, optional</span>
<span class="sd">        Width of the chart in pixels. Default is 800.</span>
<span class="sd">    height : int, optional</span>
<span class="sd">        Height of the chart in pixels. Default is 500.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    plotly.graph_objects.Figure</span>
<span class="sd">        The Plotly figure object reflecting the histogram and PDF.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># conditional import of plotly</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="kn">import</span><span class="w"> </span><span class="nn">plotly.graph_objects</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">go</span>
    <span class="k">except</span> <span class="ne">ImportError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ImportError</span><span class="p">(</span><span class="s2">&quot;Optional dependency &#39;plotly&#39; is required for all &quot;</span>
                            <span class="s2">&quot;funcsim plotting fucntions. Install with &quot;</span>
                            <span class="s2">&quot;`pip install plotly`.&quot;</span><span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">e</span>
 
    <span class="n">dataA</span> <span class="o">=</span> <span class="n">conversions</span><span class="o">.</span><span class="n">vlToArray</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">dataA</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">dataA</span><span class="p">),</span> <span class="mi">200</span><span class="p">)</span>
    <span class="n">y</span> <span class="o">=</span> <span class="p">[</span><span class="n">pdf</span><span class="p">(</span><span class="n">val</span><span class="p">)</span> <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">x</span><span class="p">]</span>

    <span class="k">if</span> <span class="n">nbins</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">bins</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">histogram_bin_edges</span><span class="p">(</span><span class="n">dataA</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="s1">&#39;auto&#39;</span><span class="p">)</span>
        <span class="n">nbinsx</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">bins</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">nbinsx</span> <span class="o">=</span> <span class="n">nbins</span>

    <span class="n">fig</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Figure</span><span class="p">()</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span><span class="n">go</span><span class="o">.</span><span class="n">Histogram</span><span class="p">(</span>
        <span class="n">x</span><span class="o">=</span><span class="n">dataA</span><span class="p">,</span> <span class="n">nbinsx</span><span class="o">=</span><span class="n">nbinsx</span><span class="p">,</span> <span class="n">histnorm</span><span class="o">=</span><span class="s1">&#39;probability density&#39;</span><span class="p">,</span> <span class="n">opacity</span><span class="o">=</span><span class="mf">0.6</span>
    <span class="p">))</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span><span class="n">go</span><span class="o">.</span><span class="n">Scatter</span><span class="p">(</span>
        <span class="n">x</span><span class="o">=</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">y</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;lines&#39;</span><span class="p">,</span> <span class="n">line</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">)</span>
    <span class="p">))</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span>
        <span class="n">yaxis_title</span><span class="o">=</span><span class="s2">&quot;Density&quot;</span><span class="p">,</span>
        <span class="n">template</span><span class="o">=</span><span class="s2">&quot;simple_white&quot;</span>
    <span class="p">)</span>
    <span class="k">if</span> <span class="n">title</span><span class="p">:</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">)</span>

    <span class="n">fig</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span><span class="n">showlegend</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
 
    <span class="k">if</span> <span class="n">title</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span>
            <span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="c1"># resize for fitting in a jupyter window without scrolling</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="n">height</span><span class="p">)</span>
 
    <span class="k">return</span> <span class="n">fig</span></div>



<div class="viewcode-block" id="dblscat">
<a class="viewcode-back" href="../api_plotting.html#funcsim.dblscat">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">dblscat</span><span class="p">(</span><span class="n">a0</span><span class="p">:</span> <span class="n">conversions</span><span class="o">.</span><span class="n">ArrayLike</span><span class="p">,</span>
            <span class="n">a1</span><span class="p">:</span> <span class="n">conversions</span><span class="o">.</span><span class="n">ArrayLike</span><span class="p">,</span>
            <span class="n">name0</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">name1</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">title</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
            <span class="n">width</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">500</span><span class="p">,</span>
            <span class="n">height</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">500</span>
            <span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Create a scatter plot reflecting two sets of paired values.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    a0 : conversions.ArrayLike</span>
<span class="sd">        First array of paired values, with shape (M, 2), with variables</span>
<span class="sd">        in columns, obs in rows.</span>
<span class="sd">    a1 : conversions.ArrayLike</span>
<span class="sd">        Second array of paired values, with shape (N, 2), variables</span>
<span class="sd">        in columns, obs in rows.</span>
<span class="sd">    name0 : str, optional</span>
<span class="sd">        Label for the first array of paired values. Default is &quot;a0&quot;.</span>
<span class="sd">    name1 : str, optional</span>
<span class="sd">        Label for the second array of paired values. Default is &quot;a1&quot;.</span>
<span class="sd">    title : str, optional</span>
<span class="sd">        Title for the figure. Default is &quot;&quot; (no title).</span>
<span class="sd">    width : int, optional</span>
<span class="sd">        Width of the chart in pixels. Default is 800.</span>
<span class="sd">    height : int, optional</span>
<span class="sd">        Height of the chart in pixels. Default is 500.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    plotly.graph_objects.Figure</span>
<span class="sd">        The Plotly figure object with both scatter plots.</span>

<span class="sd">    Raises</span>
<span class="sd">    ------</span>
<span class="sd">    ValueError</span>
<span class="sd">        If input arrays are not 2D with exactly two columns.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># conditional import of plotly</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="kn">import</span><span class="w"> </span><span class="nn">plotly.graph_objects</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">go</span>
    <span class="k">except</span> <span class="ne">ImportError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ImportError</span><span class="p">(</span><span class="s2">&quot;Optional dependency &#39;plotly&#39; is required for all &quot;</span>
                            <span class="s2">&quot;funcsim plotting fucntions. Install with &quot;</span>
                            <span class="s2">&quot;`pip install plotly`.&quot;</span><span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">e</span>

    <span class="n">a0A</span> <span class="o">=</span> <span class="n">conversions</span><span class="o">.</span><span class="n">alToArray</span><span class="p">(</span><span class="n">a0</span><span class="p">)</span>
    <span class="n">a1A</span> <span class="o">=</span> <span class="n">conversions</span><span class="o">.</span><span class="n">alToArray</span><span class="p">(</span><span class="n">a1</span><span class="p">)</span>

    <span class="c1"># names</span>
    <span class="n">varNames</span> <span class="o">=</span> <span class="n">conversions</span><span class="o">.</span><span class="n">alColNames</span><span class="p">(</span><span class="n">a0</span><span class="p">)</span>
    <span class="n">n0</span> <span class="o">=</span> <span class="n">name0</span> <span class="k">if</span> <span class="n">name0</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="s2">&quot;a0&quot;</span>
    <span class="n">n1</span> <span class="o">=</span> <span class="n">name1</span> <span class="k">if</span> <span class="n">name1</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="s2">&quot;a1&quot;</span>

    <span class="k">if</span> <span class="n">a0A</span><span class="o">.</span><span class="n">ndim</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;a0 must have exactly two dimensions&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">a1A</span><span class="o">.</span><span class="n">ndim</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;a1 must have exactly two dimensions&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">a0A</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;a0 must have exactly two columns&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">a1A</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;a1 must have exactly two columns&quot;</span><span class="p">)</span>

    <span class="n">fig</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Figure</span><span class="p">()</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span><span class="n">go</span><span class="o">.</span><span class="n">Scatter</span><span class="p">(</span>
        <span class="n">x</span><span class="o">=</span><span class="n">a0A</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">y</span><span class="o">=</span><span class="n">a0A</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;markers&#39;</span><span class="p">,</span>
        <span class="n">marker</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">symbol</span><span class="o">=</span><span class="s1">&#39;circle&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">8</span><span class="p">),</span>
        <span class="n">name</span><span class="o">=</span><span class="n">n0</span>
    <span class="p">))</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span><span class="n">go</span><span class="o">.</span><span class="n">Scatter</span><span class="p">(</span>
        <span class="n">x</span><span class="o">=</span><span class="n">a1A</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">y</span><span class="o">=</span><span class="n">a1A</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;markers&#39;</span><span class="p">,</span>
        <span class="n">marker</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;grey&#39;</span><span class="p">,</span> <span class="n">symbol</span><span class="o">=</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">8</span><span class="p">),</span>
        <span class="n">name</span><span class="o">=</span><span class="n">n1</span>
    <span class="p">))</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span>
        <span class="n">xaxis_title</span><span class="o">=</span><span class="n">varNames</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
        <span class="n">yaxis_title</span><span class="o">=</span><span class="n">varNames</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
        <span class="n">template</span><span class="o">=</span><span class="s2">&quot;simple_white&quot;</span><span class="p">,</span>
        <span class="n">legend</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mf">0.99</span><span class="p">)</span>
    <span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">update_yaxes</span><span class="p">(</span>
        <span class="n">scaleanchor</span><span class="o">=</span><span class="s2">&quot;x&quot;</span><span class="p">,</span>
        <span class="n">scaleratio</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">)</span>

    <span class="k">if</span> <span class="n">title</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span>
            <span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="c1"># resize for fitting in a jupyter window without scrolling</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="n">height</span><span class="p">)</span>
 
    <span class="k">return</span> <span class="n">fig</span></div>




<div class="viewcode-block" id="qqplot">
<a class="viewcode-back" href="../api_plotting.html#funcsim.qqplot">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">qqplot</span><span class="p">(</span><span class="n">data</span><span class="p">:</span> <span class="n">conversions</span><span class="o">.</span><span class="n">VectorLike</span><span class="p">,</span>
           <span class="n">ppf</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="nb">float</span><span class="p">],</span> <span class="nb">float</span><span class="p">],</span>
           <span class="n">title</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
           <span class="n">width</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">500</span><span class="p">,</span>
           <span class="n">height</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">500</span>
           <span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Create a Q-Q plot comparing data quantiles to a theoretical distribution.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    data : VectorLike</span>
<span class="sd">        Input data to compare to the hypothesized distribution.</span>
<span class="sd">    ppf : Callable[[float], float]</span>
<span class="sd">        Percent point function (inverse CDF) of the hypothesized distribution.</span>
<span class="sd">        Should accept a float in (0, 1) and return a float.</span>
<span class="sd">    title : str, optional</span>
<span class="sd">        Title for the figure. Default is &quot;&quot; (no title).</span>
<span class="sd">    width : int, optional</span>
<span class="sd">        Width of the chart in pixels. Default is 500.</span>
<span class="sd">    height : int, optional</span>
<span class="sd">        Height of the chart in pixels. Default is 500.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    plotly.graph_objects.Figure</span>
<span class="sd">        The Plotly figure object for the Q-Q plot.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># conditional import of plotly</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="kn">import</span><span class="w"> </span><span class="nn">plotly.graph_objects</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">go</span>
    <span class="k">except</span> <span class="ne">ImportError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ImportError</span><span class="p">(</span><span class="s2">&quot;Optional dependency &#39;plotly&#39; is required for all &quot;</span>
                          <span class="s2">&quot;funcsim plotting fucntions. Install with &quot;</span>
                          <span class="s2">&quot;`pip install plotly`.&quot;</span><span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">e</span>

    <span class="n">dataA</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">conversions</span><span class="o">.</span><span class="n">vlToArray</span><span class="p">(</span><span class="n">data</span><span class="p">))</span>
    <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">dataA</span><span class="p">)</span>
    <span class="n">probs</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">n</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="mf">0.5</span><span class="p">)</span> <span class="o">/</span> <span class="n">n</span>
    <span class="n">theor</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">ppf</span><span class="p">(</span><span class="n">p</span><span class="p">)</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">probs</span><span class="p">])</span>

    <span class="n">fig</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Figure</span><span class="p">()</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span><span class="n">go</span><span class="o">.</span><span class="n">Scatter</span><span class="p">(</span>
        <span class="n">x</span><span class="o">=</span><span class="n">theor</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">dataA</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;markers&#39;</span><span class="p">,</span>
        <span class="n">marker</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">7</span><span class="p">)</span>
    <span class="p">))</span>
    <span class="c1"># Add 45-degree reference line</span>
    <span class="n">min_val</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">theor</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">dataA</span><span class="p">))</span>
    <span class="n">max_val</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">theor</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">dataA</span><span class="p">))</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span><span class="n">go</span><span class="o">.</span><span class="n">Scatter</span><span class="p">(</span>
        <span class="n">x</span><span class="o">=</span><span class="p">[</span><span class="n">min_val</span><span class="p">,</span> <span class="n">max_val</span><span class="p">],</span> <span class="n">y</span><span class="o">=</span><span class="p">[</span><span class="n">min_val</span><span class="p">,</span> <span class="n">max_val</span><span class="p">],</span>
        <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;lines&#39;</span><span class="p">,</span> <span class="n">line</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">dash</span><span class="o">=</span><span class="s1">&#39;dash&#39;</span><span class="p">)</span>
    <span class="p">))</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span>
        <span class="n">xaxis_title</span><span class="o">=</span><span class="s2">&quot;Hypothesized Quantiles&quot;</span><span class="p">,</span>
        <span class="n">yaxis_title</span><span class="o">=</span><span class="s2">&quot;Sample Quantiles&quot;</span><span class="p">,</span>
        <span class="n">template</span><span class="o">=</span><span class="s2">&quot;simple_white&quot;</span>
    <span class="p">)</span>

    <span class="n">fig</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span><span class="n">showlegend</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
 
    <span class="k">if</span> <span class="n">title</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">)</span>

    <span class="n">fig</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="n">height</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">fig</span></div>



<div class="viewcode-block" id="show">
<a class="viewcode-back" href="../api_plotting.html#funcsim.show">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">show</span><span class="p">(</span><span class="n">fig</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Flexibly display a plotly plot in a Jupyter notebook.</span>

<span class="sd">    Invokes plotly&#39;s fig.show() with a `renderer` argument set to the value</span>
<span class="sd">    in the environment variable FUNCSIM_PLOTLY_RENDERER.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    fig : plotly.graph_objects.Figure</span>
<span class="sd">        Plotly figure to be displayed.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># conditional import of plotly</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="kn">import</span><span class="w"> </span><span class="nn">plotly.graph_objects</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">go</span>
    <span class="k">except</span> <span class="ne">ImportError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ImportError</span><span class="p">(</span><span class="s2">&quot;Optional dependency &#39;plotly&#39; is required for all &quot;</span>
                            <span class="s2">&quot;funcsim plotting functions. Install with &quot;</span>
                            <span class="s2">&quot;`pip install plotly`.&quot;</span><span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">e</span>

    <span class="c1"># conditional import of Ipython.display.Image</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="kn">from</span><span class="w"> </span><span class="nn">IPython.display</span><span class="w"> </span><span class="kn">import</span> <span class="n">Image</span>
    <span class="k">except</span> <span class="ne">ImportError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ImportError</span><span class="p">(</span><span class="s2">&quot;Optional dependency &#39;Ipython&#39; is required for &quot;</span>
                            <span class="s2">&quot;funcsim.show(). Install with &quot;</span>
                            <span class="s2">&quot;`pip install jupyter`.&quot;</span><span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">e</span>

    <span class="c1"># do the thing</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">renderer</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">&quot;FUNCSIM_PLOTLY_RENDERER&quot;</span><span class="p">))</span></div>

</pre></div>

          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="Main">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../index.html">funcsim</a></h1>









<search id="searchbox" style="display: none" role="search">
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" placeholder="Search"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</search>
<script>document.getElementById('searchbox').style.display = "block"</script><h3>Navigation</h3>
<p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../overview.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api_reference.html">API Reference</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
  <li><a href="index.html">Module code</a><ul>
  </ul></li>
  </ul></li>
</ul>
</div>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &#169;2017-2025, Henry Bryant.
      
      |
      Powered by <a href="https://www.sphinx-doc.org/">Sphinx 8.2.3</a>
      &amp; <a href="https://alabaster.readthedocs.io">Alabaster 1.0.0</a>
      
    </div>

    

    
  </body>
</html>